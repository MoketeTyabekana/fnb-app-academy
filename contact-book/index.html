<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="style.css" />

    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined"
    />
  </head>
  <body onload="fetchContacts()">
    <nav>
      <div class="logo">
        <span class="material-symbols-outlined">contacts</span>
        <h1>Contact Book</h1>
      </div>

      <div class="buttons">
        <span
          class="material-symbols-outlined"
          onclick="fetchContacts()"
          style="cursor: pointer"
          >refresh</span
        >
        <span
          class="material-symbols-outlined"
          onclick="addContact()"
          style="cursor: pointer"
          >person_add</span
        >
      </div>
    </nav>

    <section>
      <input type="search" id="search" placeholder="Search Contacts" />
      <div id="table">
        <p id="loading-text">Contacts Loading...</p>
      </div>
    </section>

    <script src="config.js"></script>
    <script>
      function fetchContacts() {
        fetch(rootPath + "controller/get-contacts/")
          .then(function (response) {
            return response.json();
          })
          .then(function (data) {
            displayOutput(data);
          });
      }

      function displayOutput(contactArray) {
        contactArray.sort(function (a, b) {
          const nameA = (a.firstname + " " + a.lastname).toLowerCase();
          const nameB = (b.firstname + " " + b.lastname).toLowerCase();
          if (nameA < nameB) return -1;
          if (nameA > nameB) return 1;
          return 0;
        });

        output = "<table class='table'>";

        for (a in contactArray) {
          output += `
                    <tr onclick="editContact(${contactArray[a].id})">
                        <td><img src="${rootPath}controller/uploads/${contactArray[a].avatar}" width="40" height="40"/></td>
                        <td><h4  >${contactArray[a].firstname}</h4></td>
                        <td><h4 >${contactArray[a].lastname}</h4></td>
                    </tr>
                    `;
        }

        output += "</table>";
        document.getElementById("table").innerHTML = output;
      }

      function editContact(id) {
        window.open("edit-contact.html?id=" + id, "_self");
      }

      function addContact() {
        window.open("insert-contact.html?", "_self");
      }
    </script>
  </body>
</html>
